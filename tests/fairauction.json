{
  "types": {
    "AuctionInfo": [
      {"field": "color", "type": "Color"},
      {"field": "num_tokens", "type": "Int"},
      {"field": "minimum_bid", "type": "Int"},
      {"field": "description", "type": "String"},
      {"field": "when_started", "type": "Int"},
      {"field": "duration", "type": "Int"},
      {"field": "auction_owner", "type": "Agent"},
      {"field": "deposit", "type": "Int"},
      {"field": "owner_margin", "type": "Int"},
      {"field": "bids", "type": "[]BidInfo"}
    ],
    "BidInfo": [
      {"field": "bidder", "type": "Agent"},
      {"field": "amount", "type": "Int"},
      {"field": "when", "type": "Int"}
    ]
  },
  "setups": {
    "default": {
      "contract": {
        "name": "fairauction",
        "description": "Auction colored tokens",
        "id": "@scId",
        "owner": "@scOwner"
      },
      "balances": {"#iota": 100},
      "timestamp": 20201027172138,
      "caller": "@caller"
    }
  },
  "tests": [
    {
      "name": "startAuction",
      "setup": "default",
      "function": "start_auction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "expect": {
        "balances": {"#iota": 200, "#tokenColor": 1},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "num_tokens": 1,
                "minimum_bid": 500,
                "description": "N/A",
                "when_started": 20201027172138,
                "duration": 60,
                "auction_owner": "@caller",
                "deposit": 100,
                "owner_margin": 50,
                "bids": []
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalize_auction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": []
      }
    },
    {
      "name": "noBids",
      "setup": "default",
      "flags": "nodelay",
      "function": "start_auction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "expect": {
        "balances": {"#iota": 101, "#tokenColor": 0},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "num_tokens": 1,
                "minimum_bid": 500,
                "description": "N/A",
                "when_started": 20201027172138,
                "duration": 60,
                "auction_owner": "@caller",
                "deposit": 100,
                "owner_margin": 50,
                "bids": []
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalize_auction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": [
          {"agent": "@scOwner", "#iota": 24},
          {"agent": "@caller", "#tokenColor": 1},
          {"agent": "@caller", "#iota": 75}
        ]
      }
    },
    {
      "name": "singleBid",
      "setup": "default",
      "function": "start_auction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "additionalRequests": [
        {
          "timestamp": 20201027172139,
          "caller": "@bidder1",
          "function": "place_bid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        }
      ],
      "expect": {
        "balances": {"#iota": 800, "#tokenColor": 1},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "num_tokens": 1,
                "minimum_bid": 500,
                "description": "N/A",
                "when_started": 20201027172138,
                "duration": 60,
                "auction_owner": "@caller",
                "deposit": 100,
                "owner_margin": 50,
                "bids": [
                  {
                    "bidder": "@bidder1",
                    "amount": 600,
                    "when": 20201027172139
                  }
                ]
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalize_auction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": []
      }
    },
    {
      "name": "fourBids",
      "setup": "default",
      "function": "start_auction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "additionalRequests": [
        {
          "timestamp": 20201027172139,
          "caller": "@bidder1",
          "function": "place_bid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172140,
          "caller": "@bidder2",
          "function": "place_bid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172141,
          "caller": "@bidder3",
          "function": "place_bid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172142,
          "caller": "@bidder4",
          "function": "place_bid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        }
      ],
      "expect": {
        "balances": {"#iota": 2800, "#tokenColor": 1},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "num_tokens": 1,
                "minimum_bid": 500,
                "description": "N/A",
                "when_started": 20201027172138,
                "duration": 60,
                "auction_owner": "@caller",
                "deposit": 100,
                "owner_margin": 50,
                "bids": [
                  {
                    "bidder": "@bidder1",
                    "amount": 600,
                    "when": 20201027172139
                  },
                  {
                    "bidder": "@bidder2",
                    "amount": 700,
                    "when": 20201027172140
                  },
                  {
                    "bidder": "@bidder3",
                    "amount": 700,
                    "when": 20201027172141
                  },
                  {
                    "bidder": "@bidder4",
                    "amount": 600,
                    "when": 20201027172142
                  }
                ]
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalize_auction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": []
      }
    },
    {
      "name": "fourBidsAndFinalize",
      "setup": "default",
      "flags": "nodelay",
      "function": "start_auction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "additionalRequests": [
        {
          "timestamp": 20201027172139,
          "caller": "@bidder1",
          "function": "place_bid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172140,
          "caller": "@bidder2",
          "function": "place_bid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172141,
          "caller": "@bidder3",
          "function": "place_bid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172142,
          "caller": "@bidder4",
          "function": "place_bid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        }
      ],
      "expect": {
        "balances": {"#iota": 101, "#tokenColor": 0},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "num_tokens": 1,
                "minimum_bid": 500,
                "description": "N/A",
                "when_started": 20201027172138,
                "duration": 60,
                "auction_owner": "@caller",
                "deposit": 100,
                "owner_margin": 50,
                "bids": [
                  {
                    "bidder": "@bidder1",
                    "amount": 600,
                    "when": 20201027172139
                  },
                  {
                    "bidder": "@bidder2",
                    "amount": 700,
                    "when": 20201027172140
                  },
                  {
                    "bidder": "@bidder3",
                    "amount": 700,
                    "when": 20201027172141
                  },
                  {
                    "bidder": "@bidder4",
                    "amount": 600,
                    "when": 20201027172142
                  }
                ]
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalize_auction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": [
          {"agent": "@bidder1", "#iota": 600},
          {"agent": "@bidder3", "#iota": 700},
          {"agent": "@bidder4", "#iota": 600},
          {"agent": "@scOwner", "#iota": 34},
          {"agent": "@bidder2", "#tokenColor": 1},
          {"agent": "@caller", "#iota": 765}
        ]
      }
    }
  ]
}
