{
  "types": {
    "AuctionInfo": [
      {"field": "color", "type": "Color"},
      {"field": "numTokens", "type": "Int"},
      {"field": "minimumBid", "type": "Int"},
      {"field": "description", "type": "String"},
      {"field": "whenStarted", "type": "Int"},
      {"field": "duration", "type": "Int"},
      {"field": "auctionOwner", "type": "Agent"},
      {"field": "deposit", "type": "Int"},
      {"field": "ownerMargin", "type": "Int"},
      {"field": "bids", "type": "[]BidInfo"}
    ],
    "BidInfo": [
      {"field": "bidder", "type": "Agent"},
      {"field": "amount", "type": "Int"},
      {"field": "when", "type": "Int"}
    ]
  },
  "setups": {
    "default": {
      "contract": {
        "name": "fairauction",
        "description": "Auction colored tokens",
        "id": "@scId",
        "owner": "@scOwner"
      },
      "balances": {"#iota": 100},
      "timestamp": 20201027172138,
      "caller": "@caller"
    }
  },
  "tests": [
    {
      "name": "startAuction",
      "setup": "default",
      "function": "startAuction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "expect": {
        "balances": {"#iota": 200, "#tokenColor": 1},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "numTokens": 1,
                "minimumBid": 500,
                "description": "N/A",
                "whenStarted": 20201027172138,
                "duration": 60,
                "auctionOwner": "@caller",
                "deposit": 100,
                "ownerMargin": 50,
                "bids": []
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalizeAuction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": []
      }
    },
    {
      "name": "noBids",
      "setup": "default",
      "flags": "nodelay",
      "function": "startAuction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "expect": {
        "balances": {"#iota": 101, "#tokenColor": 0},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "numTokens": 1,
                "minimumBid": 500,
                "description": "N/A",
                "whenStarted": 20201027172138,
                "duration": 60,
                "auctionOwner": "@caller",
                "deposit": 100,
                "ownerMargin": 50,
                "bids": []
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalizeAuction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": [
          {"agent": "@scOwner", "color": "#iota", "amount": 24},
          {"agent": "@caller", "color": "#tokenColor", "amount": 1},
          {"agent": "@caller", "color": "#iota", "amount": 75}
        ]
      }
    },
    {
      "name": "singleBid",
      "setup": "default",
      "function": "startAuction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "additionalRequests": [
        {
          "timestamp": 20201027172139,
          "caller": "@bidder1",
          "function": "placeBid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        }
      ],
      "expect": {
        "balances": {"#iota": 800, "#tokenColor": 1},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "numTokens": 1,
                "minimumBid": 500,
                "description": "N/A",
                "whenStarted": 20201027172138,
                "duration": 60,
                "auctionOwner": "@caller",
                "deposit": 100,
                "ownerMargin": 50,
                "bids": [
                  {
                    "bidder": "@bidder1",
                    "amount": 600,
                    "when": 20201027172139
                  }
                ]
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalizeAuction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": []
      }
    },
    {
      "name": "fourBids",
      "setup": "default",
      "function": "startAuction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "additionalRequests": [
        {
          "timestamp": 20201027172139,
          "caller": "@bidder1",
          "function": "placeBid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172140,
          "caller": "@bidder2",
          "function": "placeBid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172141,
          "caller": "@bidder3",
          "function": "placeBid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172142,
          "caller": "@bidder4",
          "function": "placeBid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        }
      ],
      "expect": {
        "balances": {"#iota": 2800, "#tokenColor": 1},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "numTokens": 1,
                "minimumBid": 500,
                "description": "N/A",
                "whenStarted": 20201027172138,
                "duration": 60,
                "auctionOwner": "@caller",
                "deposit": 100,
                "ownerMargin": 50,
                "bids": [
                  {
                    "bidder": "@bidder1",
                    "amount": 600,
                    "when": 20201027172139
                  },
                  {
                    "bidder": "@bidder2",
                    "amount": 700,
                    "when": 20201027172140
                  },
                  {
                    "bidder": "@bidder3",
                    "amount": 700,
                    "when": 20201027172141
                  },
                  {
                    "bidder": "@bidder4",
                    "amount": 600,
                    "when": 20201027172142
                  }
                ]
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalizeAuction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": []
      }
    },
    {
      "name": "fourBidsAndFinalize",
      "setup": "default",
      "flags": "nodelay",
      "function": "startAuction",
      "incoming": {"#iota": 100, "#tokenColor": 1},
      "params": {
        "color": "#tokenColor",
        "minimum": 500
      },
      "additionalRequests": [
        {
          "timestamp": 20201027172139,
          "caller": "@bidder1",
          "function": "placeBid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172140,
          "caller": "@bidder2",
          "function": "placeBid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172141,
          "caller": "@bidder3",
          "function": "placeBid",
          "incoming": {"#iota": 700},
          "params": {
            "color": "#tokenColor"
          }
        },
        {
          "timestamp": 20201027172142,
          "caller": "@bidder4",
          "function": "placeBid",
          "incoming": {"#iota": 600},
          "params": {
            "color": "#tokenColor"
          }
        }
      ],
      "expect": {
        "balances": {"#iota": 101, "#tokenColor": 0},
        "state": {
          "auctions": {
            "#tokenColor": {
              "AuctionInfo": {
                "color": "#tokenColor",
                "numTokens": 1,
                "minimumBid": 500,
                "description": "N/A",
                "whenStarted": 20201027172138,
                "duration": 60,
                "auctionOwner": "@caller",
                "deposit": 100,
                "ownerMargin": 50,
                "bids": [
                  {
                    "bidder": "@bidder1",
                    "amount": 600,
                    "when": 20201027172139
                  },
                  {
                    "bidder": "@bidder2",
                    "amount": 700,
                    "when": 20201027172140
                  },
                  {
                    "bidder": "@bidder3",
                    "amount": 700,
                    "when": 20201027172141
                  },
                  {
                    "bidder": "@bidder4",
                    "amount": 600,
                    "when": 20201027172142
                  }
                ]
              }
            }
          }
        },
        "logs": {},
        "posts": [
          {
            "function": "finalizeAuction", "delay": 3600,
            "params": {"color": "#tokenColor"}
          }
        ],
        "transfers": [
          {"agent": "@bidder1", "color": "#iota", "amount": 600},
          {"agent": "@bidder3", "color": "#iota", "amount": 700},
          {"agent": "@bidder4", "color": "#iota", "amount": 600},
          {"agent": "@scOwner", "color": "#iota", "amount": 34},
          {"agent": "@bidder2", "color": "#tokenColor", "amount": 1},
          {"agent": "@caller", "color": "#iota", "amount": 765}
        ]
      }
    }
  ]
}
